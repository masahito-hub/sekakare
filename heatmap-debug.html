<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ« - ã‚»ã‚«ã‚«ãƒ¬</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #ff6b00;
            border-bottom: 3px solid #ff6b00;
            padding-bottom: 10px;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .param-group {
            margin: 15px 0;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .value-display {
            display: inline-block;
            min-width: 60px;
            text-align: right;
            font-family: monospace;
            color: #666;
        }
        button {
            background: #ff6b00;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #e55f00;
        }
        button.secondary {
            background: #666;
        }
        button.secondary:hover {
            background: #555;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196f3;
            margin: 15px 0;
        }
        .warning {
            background: #fff3e0;
            padding: 15px;
            border-left: 4px solid #ff9800;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ› ï¸ ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>

    <div class="info">
        <strong>æ³¨æ„:</strong> ã“ã®ãƒ„ãƒ¼ãƒ«ã¯é–‹ç™ºè€…å‘ã‘ã§ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª¿æ•´ã—ã¦localStorageã«ä¿å­˜ã™ã‚‹ã¨ã€ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã®ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã«åæ˜ ã•ã‚Œã¾ã™ã€‚
    </div>

    <div class="section">
        <h2>ğŸ“ ã‚ºãƒ¼ãƒ é€£å‹•åŠå¾„</h2>

        <div class="param-group">
            <label>åŸºæº–ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ« (z_ref): <span class="value-display" id="z_ref_value">14</span></label>
            <input type="range" id="z_ref" min="10" max="18" step="1" value="14">
        </div>

        <div class="param-group">
            <label>åŸºæº–åŠå¾„ px (r_base): <span class="value-display" id="r_base_value">14</span></label>
            <input type="range" id="r_base" min="8" max="24" step="1" value="14">
        </div>

        <div class="param-group">
            <label>ä¿‚æ•° (k): <span class="value-display" id="k_value">1.28</span></label>
            <input type="range" id="k" min="1.1" max="1.5" step="0.01" value="1.28">
        </div>

        <div class="param-group">
            <label>æœ€å°åŠå¾„ px (r_min_px): <span class="value-display" id="r_min_px_value">16</span></label>
            <input type="range" id="r_min_px" min="8" max="32" step="1" value="16">
        </div>

        <div class="param-group">
            <label>æœ€å¤§åŠå¾„ px (r_max_px): <span class="value-display" id="r_max_px_value">48</span></label>
            <input type="range" id="r_max_px" min="32" max="80" step="1" value="48">
        </div>
    </div>

    <div class="section">
        <h2>ğŸ¨ é€æ˜åº¦ã¨å¯†åº¦</h2>

        <div class="param-group">
            <label>åŸºæœ¬é€æ˜åº¦ (alpha_base): <span class="value-display" id="alpha_base_value">0.55</span></label>
            <input type="range" id="alpha_base" min="0.3" max="0.8" step="0.05" value="0.55">
        </div>

        <div class="param-group">
            <label>å­¤ç«‹é–¾å€¤ (tau): <span class="value-display" id="tau_value">3</span></label>
            <input type="range" id="tau" min="1" max="10" step="1" value="3">
        </div>

        <div class="param-group">
            <label>å­¤ç«‹ãƒ–ãƒ¼ã‚¹ãƒˆ (isolation_boost): <span class="value-display" id="isolation_boost_value">1.25</span></label>
            <input type="range" id="isolation_boost" min="1.0" max="2.0" step="0.05" value="1.25">
        </div>
    </div>

    <div class="section">
        <h2>ğŸŒˆ è‰²ãƒãƒƒãƒ— (LCH)</h2>

        <div class="warning">
            <strong>ä¸Šç´šè€…å‘ã‘:</strong> LCHè‰²ç©ºé–“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚å¤‰æ›´ã™ã‚‹ã¨è‰²ã®è¦‹ãˆæ–¹ãŒå¤§ããå¤‰ã‚ã‚Šã¾ã™ã€‚
        </div>

        <h3>é–‹å§‹è‰²ï¼ˆæ·¡ã„é»„è‰²ï¼‰</h3>
        <div class="param-group">
            <label>L (æ˜åº¦): <span class="value-display" id="color_start_L_value">95</span></label>
            <input type="range" id="color_start_L" min="70" max="100" step="1" value="95">
        </div>
        <div class="param-group">
            <label>C (å½©åº¦): <span class="value-display" id="color_start_C_value">45</span></label>
            <input type="range" id="color_start_C" min="20" max="80" step="1" value="45">
        </div>
        <div class="param-group">
            <label>H (è‰²ç›¸): <span class="value-display" id="color_start_H_value">95</span></label>
            <input type="range" id="color_start_H" min="60" max="120" step="1" value="95">
        </div>

        <h3>çµ‚äº†è‰²ï¼ˆç¥ç€è‰²ï¼‰</h3>
        <div class="param-group">
            <label>L (æ˜åº¦): <span class="value-display" id="color_end_L_value">72</span></label>
            <input type="range" id="color_end_L" min="50" max="90" step="1" value="72">
        </div>
        <div class="param-group">
            <label>C (å½©åº¦): <span class="value-display" id="color_end_C_value">65</span></label>
            <input type="range" id="color_end_C" min="40" max="90" step="1" value="65">
        </div>
        <div class="param-group">
            <label>H (è‰²ç›¸): <span class="value-display" id="color_end_H_value">80</span></label>
            <input type="range" id="color_end_H" min="60" max="100" step="1" value="80">
        </div>

        <div class="param-group">
            <label>ã‚¬ãƒ³ãƒè£œæ­£ (gamma): <span class="value-display" id="gamma_value">1.45</span></label>
            <input type="range" id="gamma" min="1.0" max="2.5" step="0.05" value="1.45">
        </div>
    </div>

    <div class="section">
        <h2>ğŸ“Š æ­£è¦åŒ–</h2>

        <div class="param-group">
            <label>ä¸‹é™ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« (percentile_low): <span class="value-display" id="percentile_low_value">5</span></label>
            <input type="range" id="percentile_low" min="0" max="20" step="1" value="5">
        </div>

        <div class="param-group">
            <label>ä¸Šé™ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« (percentile_high): <span class="value-display" id="percentile_high_value">95</span></label>
            <input type="range" id="percentile_high" min="80" max="100" step="1" value="95">
        </div>
    </div>

    <div class="section">
        <h2>âš™ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>

        <div class="param-group">
            <label>ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ™‚é–“ ms (debounce_ms): <span class="value-display" id="debounce_ms_value">150</span></label>
            <input type="range" id="debounce_ms" min="50" max="500" step="50" value="150">
        </div>
    </div>

    <div class="section" style="text-align: center;">
        <button onclick="saveParams()">ğŸ’¾ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿å­˜</button>
        <button class="secondary" onclick="resetParams()">ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
        <button class="secondary" onclick="window.location.href='/'">ğŸ  ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã¸</button>
    </div>

    <script>
        // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®šç¾©
        const params = [
            { id: 'z_ref', type: 'number' },
            { id: 'r_base', type: 'number' },
            { id: 'k', type: 'number' },
            { id: 'r_min_px', type: 'number' },
            { id: 'r_max_px', type: 'number' },
            { id: 'alpha_base', type: 'number' },
            { id: 'tau', type: 'number' },
            { id: 'isolation_boost', type: 'number' },
            { id: 'color_start_L', type: 'number', path: 'color_start.L' },
            { id: 'color_start_C', type: 'number', path: 'color_start.C' },
            { id: 'color_start_H', type: 'number', path: 'color_start.H' },
            { id: 'color_end_L', type: 'number', path: 'color_end.L' },
            { id: 'color_end_C', type: 'number', path: 'color_end.C' },
            { id: 'color_end_H', type: 'number', path: 'color_end.H' },
            { id: 'gamma', type: 'number' },
            { id: 'percentile_low', type: 'number' },
            { id: 'percentile_high', type: 'number' },
            { id: 'debounce_ms', type: 'number' }
        ];

        // å€¤è¡¨ç¤ºã‚’æ›´æ–°
        function updateValueDisplay(param) {
            const input = document.getElementById(param.id);
            const display = document.getElementById(param.id + '_value');
            if (input && display) {
                display.textContent = input.value;
            }
        }

        // ã™ã¹ã¦ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
        params.forEach(param => {
            const input = document.getElementById(param.id);
            if (input) {
                input.addEventListener('input', () => updateValueDisplay(param));
                updateValueDisplay(param);
            }
        });

        // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿å­˜
        function saveParams() {
            const config = {};

            params.forEach(param => {
                const input = document.getElementById(param.id);
                if (input) {
                    const value = param.type === 'number' ? parseFloat(input.value) : input.value;

                    if (param.path) {
                        // ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ‘ã‚¹ã®å ´åˆï¼ˆä¾‹: color_start.Lï¼‰
                        const parts = param.path.split('.');
                        let obj = config;
                        for (let i = 0; i < parts.length - 1; i++) {
                            if (!obj[parts[i]]) obj[parts[i]] = {};
                            obj = obj[parts[i]];
                        }
                        obj[parts[parts.length - 1]] = value;
                    } else {
                        config[param.id] = value;
                    }
                }
            });

            localStorage.setItem('sekakare_heatmap_params', JSON.stringify(config));
            alert('âœ… ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼\n\nãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨åæ˜ ã•ã‚Œã¾ã™ã€‚');
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
        function resetParams() {
            if (confirm('ã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('sekakare_heatmap_params');
                location.reload();
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¿å­˜æ¸ˆã¿ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
        function loadSavedParams() {
            try {
                const saved = localStorage.getItem('sekakare_heatmap_params');
                if (saved) {
                    const config = JSON.parse(saved);

                    params.forEach(param => {
                        const input = document.getElementById(param.id);
                        if (input) {
                            let value;
                            if (param.path) {
                                const parts = param.path.split('.');
                                value = config;
                                for (const part of parts) {
                                    value = value ? value[part] : undefined;
                                }
                            } else {
                                value = config[param.id];
                            }

                            if (value !== undefined) {
                                input.value = value;
                                updateValueDisplay(param);
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Failed to load saved params:', error);
            }
        }

        // åˆæœŸåŒ–
        loadSavedParams();
    </script>
</body>
</html>

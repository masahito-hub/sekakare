<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Config Debug Check</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .key-display {
            font-family: monospace;
            background: #f9f9f9;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ” APIã‚­ãƒ¼è¨­å®šãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>

        <div id="loading" class="status info">è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

        <div id="results" style="display: none;">
            <h2>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®çŠ¶æ…‹</h2>
            <div id="configStatus"></div>

            <h2>APIã‚­ãƒ¼æƒ…å ±</h2>
            <div id="keyInfo"></div>

            <h2>ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h2>
            <pre id="debugInfo"></pre>

            <h2>è§£æ±ºæ–¹æ³•</h2>
            <div id="solution"></div>
        </div>
    </div>

    <!-- config.jsã‚’èª­ã¿è¾¼ã¿ -->
    <script src="assets/js/config.js"></script>

    <script>
        window.addEventListener('load', function() {
            const loadingDiv = document.getElementById('loading');
            const resultsDiv = document.getElementById('results');
            const configStatusDiv = document.getElementById('configStatus');
            const keyInfoDiv = document.getElementById('keyInfo');
            const debugInfoDiv = document.getElementById('debugInfo');
            const solutionDiv = document.getElementById('solution');

            setTimeout(() => {
                loadingDiv.style.display = 'none';
                resultsDiv.style.display = 'block';

                // Config ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å­˜åœ¨ç¢ºèª
                if (typeof Config === 'undefined') {
                    configStatusDiv.innerHTML = '<div class="status error">âŒ Config ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                    solutionDiv.innerHTML = '<div class="status error">config.js ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
                    return;
                }

                configStatusDiv.innerHTML = '<div class="status success">âœ… Config ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ</div>';

                // APIã‚­ãƒ¼ã®çŠ¶æ…‹ã‚’ç¢ºèª
                const apiKey = Config.API_KEY;
                let keyStatus = '';
                let solution = '';

                if (!apiKey) {
                    keyStatus = '<div class="status error">âŒ APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆundefined ã¾ãŸã¯ nullï¼‰</div>';
                    solution = '<div class="status error">GitHub Secretsã®è¨­å®šã‚’ç¢ºèªã—ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å†å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</div>';
                } else if (apiKey === 'YOUR_API_KEY_HERE') {
                    keyStatus = '<div class="status error">âŒ APIã‚­ãƒ¼ãŒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ã¾ã¾ã§ã™</div>';
                    solution = '<div class="status error">ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«APIã‚­ãƒ¼ã®ç½®æ›ãŒå¤±æ•—ã—ã¦ã„ã¾ã™ã€‚GitHub Actionsã®ãƒ­ã‚°ã¨Secretsã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
                } else {
                    keyStatus = '<div class="status success">âœ… APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™</div>';
                    solution = '<div class="status success">APIã‚­ãƒ¼ã¯æ­£å¸¸ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚Google Cloud Consoleã§APIã‚­ãƒ¼ã®æœ‰åŠ¹æ€§ã¨APIæœ‰åŠ¹åŒ–ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
                }

                keyInfoDiv.innerHTML = keyStatus +
                    '<div class="key-display">ã‚­ãƒ¼ã®é•·ã•: ' + (apiKey ? apiKey.length : 0) + ' æ–‡å­—</div>' +
                    '<div class="key-display">æœ€åˆã®10æ–‡å­—: ' + (apiKey ? apiKey.substring(0, 10) + '...' : 'N/A') + '</div>';

                // ãƒ‡ãƒãƒƒã‚°æƒ…å ±
                const debugData = {
                    configExists: typeof Config !== 'undefined',
                    apiKeyExists: !!apiKey,
                    apiKeyIsPlaceholder: apiKey === 'YOUR_API_KEY_HERE',
                    apiKeyLength: apiKey ? apiKey.length : 0,
                    validateApiKeyFunction: typeof validateApiKey !== 'undefined',
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent
                };

                debugInfoDiv.textContent = JSON.stringify(debugData, null, 2);
                solutionDiv.innerHTML = solution;

                // validateApiKeyé–¢æ•°ã‚’å®Ÿè¡Œ
                if (typeof validateApiKey !== 'undefined') {
                    console.log('validateApiKey()ã‚’å®Ÿè¡Œä¸­...');
                    const isValid = validateApiKey();
                    console.log('validateApiKey() çµæœ:', isValid);
                }
            }, 1000);
        });
    </script>
</body>
</html>
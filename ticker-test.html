<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ†ã‚£ãƒƒã‚«ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ - ã‚»ã‚«ã‚«ãƒ¬</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #ff8c00;
            margin-bottom: 30px;
        }

        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group h3 {
            margin-bottom: 10px;
            color: #333;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #ff8c00;
            color: white;
            font-size: 14px;
            transition: background 0.3s;
        }

        button:hover {
            background: #ff6b00;
        }

        button.secondary {
            background: #6c757d;
        }

        button.secondary:hover {
            background: #5a6268;
        }

        .status-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .status-item {
            padding: 10px;
            margin: 10px 0;
            background: #f8f9fa;
            border-left: 3px solid #ff8c00;
            border-radius: 4px;
        }

        .preview-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }

        .test-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #ffc107;
        }

        .test-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .test-case {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }

        .test-case code {
            background: #f8f9fa;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }

        .success {
            color: green;
        }

        .danger {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ãƒ†ã‚£ãƒƒã‚«ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</h1>

        <div class="control-panel">
            <div class="control-group">
                <h3>ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡</h3>
                <button id="clearTickerCache">ãƒ†ã‚£ãƒƒã‚«ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢</button>
                <button id="showCacheStatus" class="secondary">ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹ã‚’è¡¨ç¤º</button>
                <div id="cacheStatus" style="margin-top: 10px;"></div>
            </div>

            <div class="control-group">
                <h3>ãƒšãƒ¼ã‚¸åˆ¶å¾¡</h3>
                <button id="reloadFrame">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãƒªãƒ­ãƒ¼ãƒ‰</button>
                <button id="openNewTab" class="secondary">æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã</button>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ</h3>
            <div class="test-case">
                <strong>URLæ¤œè¨¼ãƒ†ã‚¹ãƒˆ:</strong>
                <ul>
                    <li>ç„¡åŠ¹ãªURL (javascript:alert('XSS')) â†’ <span id="test-invalid-url">æœªãƒ†ã‚¹ãƒˆ</span></li>
                    <li>æœ‰åŠ¹ãªURL (https://example.com) â†’ <span id="test-valid-url">æœªãƒ†ã‚¹ãƒˆ</span></li>
                    <li>ãƒ‡ãƒ¼ã‚¿URL (data:text/html,test) â†’ <span id="test-data-url">æœªãƒ†ã‚¹ãƒˆ</span></li>
                </ul>
            </div>
            <div class="test-case">
                <strong>XSSå¯¾ç­–ãƒ†ã‚¹ãƒˆ:</strong>
                <ul>
                    <li>HTMLã‚¿ã‚°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— (&lt;script&gt;alert&lt;/script&gt;) â†’ <span id="test-xss-escape">æœªãƒ†ã‚¹ãƒˆ</span></li>
                </ul>
            </div>
            <button id="runSecurityTests">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
        </div>

        <div class="status-panel">
            <h3>ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
            <div class="status-item">
                <strong>ãƒ†ã‚£ãƒƒã‚«ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥:</strong> <span id="currentCacheStatus">ç¢ºèªä¸­...</span>
            </div>
        </div>

        <div class="preview-container">
            <h3>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
            <iframe id="preview" src="index.html"></iframe>
        </div>
    </div>

    <script>
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateStatus() {
            // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰é–¢é€£ã‚’å‰Šé™¤ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹ã®ã¿æ›´æ–°
            const cache = localStorage.getItem('sekakare_ticker_cache');
            if (cache) {
                try {
                    const data = JSON.parse(cache);
                    const age = Date.now() - data.timestamp;
                    const minutes = Math.floor(age / 60000);
                    document.getElementById('currentCacheStatus').textContent =
                        `${data.items.length}ä»¶ (${minutes}åˆ†å‰ã«å–å¾—)`;
                } catch (e) {
                    document.getElementById('currentCacheStatus').textContent = 'ç„¡åŠ¹ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥';
                }
            } else {
                document.getElementById('currentCacheStatus').textContent = 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—';
            }
        }

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
        document.getElementById('clearTickerCache').addEventListener('click', () => {
            localStorage.removeItem('sekakare_ticker_cache');
            document.getElementById('cacheStatus').innerHTML =
                '<span class="success">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</span>';
            updateStatus();
        });

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹è¡¨ç¤º
        document.getElementById('showCacheStatus').addEventListener('click', () => {
            const cache = localStorage.getItem('sekakare_ticker_cache');
            if (cache) {
                const data = JSON.parse(cache);
                document.getElementById('cacheStatus').innerHTML =
                    `<code>ã‚¢ã‚¤ãƒ†ãƒ æ•°: ${data.items.length}, ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—: ${new Date(data.timestamp).toLocaleString('ja-JP')}</code>`;
            } else {
                document.getElementById('cacheStatus').innerHTML =
                    '<code>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå­˜åœ¨ã—ã¾ã›ã‚“</code>';
            }
        });

        // ãƒ•ãƒ¬ãƒ¼ãƒ ãƒªãƒ­ãƒ¼ãƒ‰
        document.getElementById('reloadFrame').addEventListener('click', () => {
            document.getElementById('preview').src = 'index.html?' + Date.now();
        });

        // æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
        document.getElementById('openNewTab').addEventListener('click', () => {
            window.open('index.html', '_blank');
        });

        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        document.getElementById('runSecurityTests').addEventListener('click', () => {
            // ticker.jsã®é–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿéš›ã®ç’°å¢ƒã§ã¯èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã¯ãšï¼‰
            if (typeof isValidUrl === 'function') {
                // URLæ¤œè¨¼ãƒ†ã‚¹ãƒˆ
                const invalidUrl = isValidUrl('javascript:alert("XSS")');
                document.getElementById('test-invalid-url').textContent = !invalidUrl ? 'âœ… ãƒ–ãƒ­ãƒƒã‚¯' : 'âŒ é€šé';
                document.getElementById('test-invalid-url').className = !invalidUrl ? 'success' : 'danger';

                const validUrl = isValidUrl('https://example.com');
                document.getElementById('test-valid-url').textContent = validUrl ? 'âœ… é€šé' : 'âŒ ãƒ–ãƒ­ãƒƒã‚¯';
                document.getElementById('test-valid-url').className = validUrl ? 'success' : 'danger';

                const dataUrl = isValidUrl('data:text/html,test');
                document.getElementById('test-data-url').textContent = !dataUrl ? 'âœ… ãƒ–ãƒ­ãƒƒã‚¯' : 'âŒ é€šé';
                document.getElementById('test-data-url').className = !dataUrl ? 'success' : 'danger';
            } else {
                alert('ticker.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
            }

            // XSSã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãƒ†ã‚¹ãƒˆ
            if (typeof escapeHtml === 'function') {
                const escaped = escapeHtml('<script>alert("XSS")</script>');
                const isEscaped = !escaped.includes('<script>');
                document.getElementById('test-xss-escape').textContent = isEscaped ? 'âœ… ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æˆåŠŸ' : 'âŒ ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å¤±æ•—';
                document.getElementById('test-xss-escape').className = isEscaped ? 'success' : 'danger';
            }
        });

        // ticker.jsé–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
        const script = document.createElement('script');
        script.src = 'assets/js/ticker.js';
        document.head.appendChild(script);

        // åˆæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        updateStatus();
        setInterval(updateStatus, 5000); // 5ç§’ã”ã¨ã«æ›´æ–°
    </script>
</body>
</html>
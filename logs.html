<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data: https://maps.googleapis.com https://*.gstatic.com; script-src 'self' 'unsafe-inline' https://maps.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; connect-src 'self' https://maps.googleapis.com https://places.googleapis.com; font-src 'self' data: https://fonts.gstatic.com; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self';">
    
    <title>🍛 ログ - セカカレ</title>
    <meta name="description" content="あなたのカレー旅ログを時系列で振り返る">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/icons/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">

    <!-- Theme Color -->
    <meta name="theme-color" content="#ff6b00">

    <!-- CSSファイル -->
    <link rel="stylesheet" href="assets/css/logs.css">

    <!-- 共通ユーティリティ（XSS対策） -->
    <script src="assets/js/utils.js"></script>

    <!-- 設定ファイル（Config） -->
    <script src="assets/js/config.js"></script>

    <!-- ログページJS -->
    <script src="assets/js/logs.js"></script>

    <!-- ハンバーガーメニューJS -->
    <script src="assets/js/menu.js"></script>
</head>
<body>
    <!-- ヘッダー -->
    <div class="header">
        <h1>🍛 ログ</h1>
        <p class="subtitle">
            <span id="visitCount">0</span>杯のカレー履歴<br>
            <span id="dateRange"></span>
        </p>

        <!-- ハンバーガーメニューボタン -->
        <button class="hamburger" id="hamburgerBtn" aria-label="メニューを開く" aria-expanded="false">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>

    <!-- 並び替えコントロール -->
    <div class="sort-controls">
        <label for="sortSelect">並び替え:</label>
        <select id="sortSelect" class="sort-dropdown" aria-label="ログの並び替え順を選択">
            <option value="date-desc" selected>日付順（新→旧）</option>
            <option value="date-asc">日付順（旧→新）</option>
            <option value="region">地域別</option>
            <option value="visit-count">再訪回数順</option>
        </select>
    </div>

    <!-- メニューオーバーレイ -->
    <div class="menu-overlay" id="menuOverlay" aria-hidden="true"></div>

    <!-- スライドメニュー -->
    <nav class="slide-menu" id="slideMenu" aria-label="メインメニュー" aria-hidden="true">
        <button class="menu-close" id="menuClose" aria-label="メニューを閉じる">×</button>
        <ul class="menu-list">
            <li><a href="/">🏠 ホーム</a></li>
            <li><a href="/logs.html">🍛 ログ</a></li>
            <li><a href="/privacy.html">🔒 プライバシーポリシー</a></li>
            <li><a href="#" id="aboutLink">ℹ️ セカカレについて</a></li>
            <li><a href="https://x.com/sekakare" target="_blank" rel="noopener noreferrer">𝕏 公式アカウント</a></li>
        </ul>
    </nav>

    <!-- コンテナ -->
    <div class="container">
        <div id="logsContainer">
            <!-- ログまたは Empty State がここに表示される -->
        </div>
    </div>

    <!-- フッター -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; <span id="footer-year">2024</span> セカカレ. All rights reserved.</p>
            <p><a href="privacy.html">プライバシーポリシー</a></p>
        </div>
    </footer>

    <!-- 編集モーダル -->
    <div id="editModal" class="edit-modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <button class="modal-close" aria-label="閉じる">×</button>
            <h2 id="modalTitle">訪問記録を編集</h2>

            <div class="form-group">
                <label>店名</label>
                <p class="readonly" id="modalStoreName"></p>
            </div>

            <div class="form-group">
                <label for="modalVisitedAt">訪問日（任意）</label>
                <input type="date" id="modalVisitedAt" max="">
            </div>

            <div class="form-group">
                <label for="modalMenu">メニュー</label>
                <input type="text" id="modalMenu" placeholder="例: チキンカレー（辛口）">
            </div>

            <div class="form-group">
                <label for="modalMemo">一言メモ</label>
                <textarea id="modalMemo" rows="4" placeholder="思い出や気付きを記録..."></textarea>
            </div>

            <!-- 写真アップロードセクション -->
            <div class="form-group">
                <label for="modalPhotoInput">📷 写真（最大3枚）</label>
                <input 
                    type="file" 
                    id="modalPhotoInput" 
                    accept="image/jpeg,image/jpg,image/png,image/webp"
                    style="display: none;"
                    aria-label="写真を選択">
                
                <div class="photo-upload-area">
                    <div id="photoPreviewContainer" class="photo-preview-container">
                        <!-- 写真プレビューがここに表示される -->
                    </div>
                    <button type="button" id="addPhotoBtn" class="btn-add-photo" aria-label="写真を追加">
                        <span class="add-photo-icon">📷</span>
                        <span class="add-photo-text">写真を追加</span>
                    </button>
                </div>
                <p class="photo-help-text">JPEG, PNG, WebP形式。自動で圧縮されます。</p>
            </div>

            <div class="modal-actions">
                <button class="btn-cancel" id="modalCancel">キャンセル</button>
                <button class="btn-save" id="modalSave">保存</button>
            </div>
        </div>
    </div>

    <!-- 画像拡大モーダル -->
    <div id="imageViewModal" class="image-view-modal" role="dialog" aria-modal="true" style="display: none;">
        <div class="image-modal-overlay"></div>
        <div class="image-modal-content">
            <button class="image-modal-close" aria-label="閉じる">×</button>
            <button class="image-nav-prev" aria-label="前の画像" style="display: none;">‹</button>
            <img id="imageViewImg" src="" alt="拡大表示">
            <button class="image-nav-next" aria-label="次の画像" style="display: none;">›</button>
            <div class="image-counter" id="imageCounter" style="display: none;">1 / 1</div>
        </div>
    </div>

    <script>
        // フッターの著作権年を動的に設定
        document.addEventListener('DOMContentLoaded', function() {
            const footerYear = document.getElementById('footer-year');
            if (footerYear) {
                footerYear.textContent = new Date().getFullYear();
            }
        });
    </script>
</body>
</html>